<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #canvas {
            border: 1px solid black;
        }
    </style>

    <script>
        window.addEventListener("load", function () {
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var raf; // requestAnimationFrame
            var ball = {
                x: parseInt(Math.random() * 51 + 100),
                y: parseInt(Math.random() * 201 + 100),
                vx: parseInt(Math.random() * 3 + 3),
                vy: parseInt(Math.random() * 3 + 3),
                radius: 15,
                color: "blue",
                draw: function () {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
                    ctx.closePath();
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
            var player = {
                x: 760,
                y: 200,
                w: 20,
                h: 120,
                yh: 0,
                color: "red",
                draw: function () {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.w, this.h);
                    this.yh = this.y + this.h;
                }

            }

            var goUp = false;
            var goDown = false;
            var bounce = true;

            document.addEventListener("keydown", keyDownHandler, false); // this is all about if a key is pressed, doesnt matter what key that is.
            document.addEventListener("keyup", keyUpHandler, false);

            function keyDownHandler(e) {
                if (e.key == "Up" || e.key == "ArrowUp") {
                    goUp = true;
                }
                else if (e.key == "Down" || e.key == "ArrowDown") {
                    goDown = true;
                }
            }

            function keyUpHandler(e) {
                if (e.key == "Up" || e.key == "ArrowUp") {
                    goUp = false;
                }
                else if (e.key == "Down" || e.key == "ArrowDown") {
                    goDown = false;
                }
            }

            function game() {
                ctx.fillStyle = `rgba(255, 255, 255, 0.4)`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ball.draw();
                player.draw();
                document.getElementById("log").innerHTML = `${player.y} , ${player.yh}, ${(player.yh + player.y) / 2}, ball: ${ball.vx}, ${ball.vy}`;
                if (ball.x + ball.vx <= ball.radius) {
                    ball.vx = -ball.vx;
                    bounce = true;

                } else if (ball.x + ball.vx >= player.x - ball.radius && bounce) {
                    if (ball.y >= player.y && ball.y <= player.yh) {
                        let offset = Math.abs(ball.y - (player.yh + player.y) / 2);
                        document.getElementById("log2").innerHTML = offset / 14;
                        if (Math.abs(parseInt(ball.vy * (offset / 14))) > 10) {
                            ball.vy = 10;
                        } else if (Math.abs(parseInt(ball.vy * (offset / 14))) < 3) {
                            ball.vy = 3;
                        } else {
                            ball.vy = parseInt(ball.vy * (offset / 14));
                        }
                        if (Math.abs(parseInt(ball.vx * (offset / 20))) > 8) {
                            ball.vx = 8;
                        } else if (Math.abs(parseInt(ball.vx * (offset / 20))) < 3) {
                            ball.vx = 3;
                        } else {
                            ball.vx = parseInt(ball.vx * (offset / 20));
                        }
                        ball.vx = -ball.vx;
                        bounce = false;

                    } else if (ball.x + ball.vx >= canvas.width - ball.radius / 2) {
                        ball.x = parseInt(Math.random() * 51 + 100);
                        ball.y = parseInt(Math.random() * 201 + 100);
                        ball.vx = parseInt(Math.random() * 3 + 3);
                        ball.vy = parseInt(Math.random() * 3 + 3);
                    }
                }
                if (ball.y + ball.vy >= canvas.height - ball.radius || ball.y + ball.vy <= ball.radius) {
                    ball.vy = -ball.vy;
                }

                if (goDown) {
                    player.y += parseInt(player.h/(player.h/10));
                    if (player.yh > canvas.height) {
                        player.y = canvas.height - player.h;
                    }

                } else if (goUp) {
                    player.y -= parseInt(player.h/(player.h/10));
                    if (player.y <= 0) {
                        player.y = 0;
                    }
                }

                ball.x += ball.vx;
                ball.y += ball.vy;
                raf = window.requestAnimationFrame(game);
            }

            canvas.addEventListener("mouseover", function (e) {
                raf = window.requestAnimationFrame(game);

            });

            canvas.addEventListener("mouseout", function (e) {
                window.cancelAnimationFrame(raf);
            });



            player.draw();
            ball.draw();

        })

    </script>
</head>

<body>
    <canvas id="canvas" width="800" height="400"></canvas>
    <span id="log"></span>
    <span id="log2"></span>
</body>

</html>